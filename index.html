<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pola Makan Sehat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Gemini & UI libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>
  <style>
    :root {
      --primary: #35a35c;
      --accent: #5c97f5;
      --bg: #f0f6f9;
      --card: #fff;
      --text: #333;
      --muted: #777;
      --radius: 12px;
      --shadow: 0 4px 20px rgba(0,0,0,0.05);
      --transition: 0.4s ease;
    }
    * { box-sizing:border-box; margin:0; padding:0 }
    body {
      font-family:"Segoe UI",sans-serif;
      background:var(--bg);
      color:var(--text);
      padding:20px;
    }
    .container {
      max-width:540px;
      margin:auto;
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      transition:max-width var(--transition);
    }
    .container.wide { max-width:90%; }
    .logo {
      text-align:center;
      background:var(--primary);
      padding:16px;
    }
    .logo img { width:60px; border-radius:8px }
    h1 {
      text-align:center;
      margin:16px 0;
      color:var(--primary);
    }
    section { display:none; padding:24px }
    section.active { display:block }
    .step-title {
      font-weight:600;
      color:var(--primary);
      margin-bottom:16px;
      font-size:1.1rem;
    }
    .food-list {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
      max-height:240px;
      overflow-y:auto;
      margin-bottom:12px;
    }
    .food-item {
      padding:10px;
      background:#fcfcfc;
      border:1px solid #e0e0e0;
      border-radius:var(--radius);
      text-align:center;
      cursor:pointer;
      transition:background var(--transition),border-color var(--transition);
    }
    .food-item.selected {
      background:var(--accent);
      color:white;
      border-color:var(--accent);
    }
    .food-item:hover {
      border-color:var(--primary);
    }
    .count {
      margin-bottom:12px;
      color:var(--muted);
      font-size:.95rem;
    }
    .btn {
      display:block;
      width:100%;
      padding:14px;
      margin-top:16px;
      background:var(--primary);
      color:white;
      border:none;
      border-radius:var(--radius);
      font-size:1rem;
      cursor:pointer;
      transition:background var(--transition),transform var(--transition);
    }
    .btn:disabled {
      background:#ccc;
      cursor:not-allowed;
    }
    .btn:not(:disabled):hover {
      background:var(--accent);
      transform:translateY(-2px);
    }
    .summary {
      background:#fcfcfc;
      padding:16px;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      margin-bottom:16px;
    }
    #aiReview {
      min-height:100px;
      padding:16px;
      background:#fff;
      border:1px solid #e0e0e0;
      border-radius:var(--radius);
      line-height:1.5;
    }
    .spinner-overlay {
      position:fixed; inset:0;
      background:rgba(255,255,255,0.7);
      display:flex;align-items:center;justify-content:center;
      visibility:hidden; z-index:1000;
    }
    .spinner-overlay.active { visibility:visible }
    .spinner {
      width:50px;height:50px;
      border:6px solid #e0e0e0;
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin { to{transform:rotate(360deg)} }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <div class="logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo"
           alt="Logo Sekolah Al Ikhlas">
    </div>
    <h1>Pola Makan Sehat</h1>

    <!-- STEP 1: Breakfast -->
    <section id="stepBreakfast" class="active">
      <div class="step-title">Pilih 3 makanan untuk Sarapan</div>
      <div id="count-breakfast" class="count">Dipilih: 0/3</div>
      <div id="list-breakfast" class="food-list"></div>
      <button id="next-breakfast" class="btn" disabled>Next: Lunch</button>
    </section>

    <!-- STEP 2: Lunch -->
    <section id="stepLunch">
      <div class="step-title">Pilih 3 makanan untuk Makan Siang</div>
      <div id="count-lunch" class="count">Dipilih: 0/3</div>
      <div id="list-lunch" class="food-list"></div>
      <button id="next-lunch" class="btn" disabled>Next: Dinner</button>
    </section>

    <!-- STEP 3: Dinner -->
    <section id="stepDinner">
      <div class="step-title">Pilih 3 makanan untuk Makan Malam</div>
      <div id="count-dinner" class="count">Dipilih: 0/3</div>
      <div id="list-dinner" class="food-list"></div>
      <button id="next-dinner" class="btn" disabled>Lihat Ringkasan</button>
    </section>

    <!-- STEP 4: Review -->
    <section id="stepReview">
      <div class="step-title">Ringkasan Pilihan</div>
      <div class="summary">
        <strong>Sarapan:</strong> <span id="sel-breakfast"></span><br>
        <strong>Siang:</strong> <span id="sel-lunch"></span><br>
        <strong>Malam:</strong> <span id="sel-dinner"></span>
      </div>
      <button id="btnReview" class="btn">Dapatkan Review AI</button>
      <div id="aiReview" style="margin-top:16px;"></div>
    </section>
  </div>

  <div id="spinner" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // food database
    const foods = [
      "Apel","Pisang","Nasi Goreng","Soto Ayam","Rendang","Bakso",
      "Mie Goreng","Pecel Lele","Ayam Goreng","Pempek","Gado Gado",
      "Ketoprak","Lontong Sayur","Soto Betawi","Martabak Telor",
      "Martabak Manis","Bubur Ayam","Nasi Padang","Nasi Uduk","Es Campur"
    ];

    // selections
    const sel = { breakfast:[], lunch:[], dinner:[] };

    // utility: populate and handle selection
    function setupStep(type) {
      const listEl = document.getElementById("list-"+type);
      const countEl = document.getElementById("count-"+type);
      const btn = document.getElementById("next-"+type);
      // populate
      foods.forEach(name => {
        const d = document.createElement("div");
        d.className = "food-item";
        d.textContent = name;
        d.onclick = () => {
          const arr = sel[type];
          const idx = arr.indexOf(name);
          if (idx >= 0) {
            arr.splice(idx,1);
            d.classList.remove("selected");
          } else if (arr.length < 3) {
            arr.push(name);
            d.classList.add("selected");
          }
          countEl.textContent = `Dipilih: ${arr.length}/3`;
          btn.disabled = arr.length !== 3;
        };
        listEl.append(d);
      });
      return btn;
    }

    // initialize steps
    const btnBreakfast = setupStep("breakfast");
    const btnLunch     = setupStep("lunch");
    const btnDinner    = setupStep("dinner");
    const mainCon      = document.getElementById("mainContainer");

    // navigation
    btnBreakfast.onclick = () => {
      document.getElementById("stepBreakfast").classList.replace("active","hidden");
      document.getElementById("stepLunch").classList.add("active");
      mainCon.classList.add("wide");
    };
    btnLunch.onclick = () => {
      document.getElementById("stepLunch").classList.replace("active","hidden");
      document.getElementById("stepDinner").classList.add("active");
    };
    btnDinner.onclick = () => {
      document.getElementById("stepDinner").classList.replace("active","hidden");
      document.getElementById("sel-breakfast").textContent = sel.breakfast.join(", ");
      document.getElementById("sel-lunch").textContent     = sel.lunch.join(", ");
      document.getElementById("sel-dinner").textContent    = sel.dinner.join(", ");
      document.getElementById("stepReview").classList.add("active");
    };

    // review with Gemini
    document.getElementById("btnReview").onclick = async () => {
      const spinner = document.getElementById("spinner");
      spinner.classList.add("active");
      const prompt = 
        `Tinjau menu saya:\n` +
        `Sarapan: ${sel.breakfast.join(", ")}\n` +
        `Makan siang: ${sel.lunch.join(", ")}\n` +
        `Makan malam: ${sel.dinner.join(", ")}\n` +
        `Berikan saran perbaikan jika perlu.`;
      try {
        const res = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0",
          {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body: JSON.stringify({ contents:[{ parts:[{ text: prompt }] }] })
          }
        );
        const j = await res.json();
        const txt = j.candidates?.[0]?.content?.parts?.[0]?.text || 
                    "Maaf, AI gagal membuat review.";
        document.getElementById("aiReview").innerHTML = txt.replace(/\n/g,"<br>");
      } catch {
        document.getElementById("aiReview").textContent = "Error AI.";
      } finally {
        spinner.classList.remove("active");
      }
    };
  });
  </script>
</body>
</html>
