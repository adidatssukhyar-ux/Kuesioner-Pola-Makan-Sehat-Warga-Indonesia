<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pola Makan Sehat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>
  <style>
    :root {
      --primary: #35a35c;
      --accent:  #5c97f5;
      --card:    #ffffff;
      --text:    #333333;
      --muted:   #777777;
      --radius:  12px;
      --shadow:  0 4px 20px rgba(0,0,0,0.05);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Segoe UI", sans-serif;
      color: var(--text);
      padding: 20px;
      background: linear-gradient(135deg, var(--primary), #ffffff);
    }
    .container {
      max-width: 540px;
      margin: auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .logo {
      background: var(--primary);
      text-align: center;
      padding: 16px;
    }
    .logo img {
      width: 60px;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      margin: 16px 0;
      color: var(--primary);
    }
    section {
      display: none;
      padding: 24px;
    }
    section.active {
      display: block;
    }
    .step-title,
    .question-text {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 12px;
    }
    .step-title {
      font-size: 1.1rem;
    }
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #cdefe1;
      border-radius: var(--radius);
      font-size: 1rem;
      resize: vertical;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 24px;
      background: var(--primary);
      color: #ffffff;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    .btn:not(:disabled):hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
    .food-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      max-height: 240px;
      overflow-y: auto;
      margin-bottom: 12px;
    }
    .food-item {
      padding: 10px;
      background: #fcfcfc;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: background 0.3s, border-color 0.3s;
    }
    .food-item.selected {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }
    .summary {
      background: #fcfcfc;
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
    }
    #aiOverview,
    #aiReview {
      min-height: 100px;
      padding: 16px;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
      background: #ffffff;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .spinner-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      z-index: 1000;
    }
    .spinner-overlay.active {
      visibility: visible;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #e0e0e0;
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <div class="logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo" alt="Logo">
    </div>
    <h1>Pola Makan Sehat</h1>

    <section id="stepSurvey" class="active">
      <div class="step-title">Survey Singkat</div>
      <div class="question-text" id="surveyQ"></div>
      <textarea id="surveyA" rows="3" placeholder="Tuliskan jawaban…"></textarea>
      <button id="surveyNext" class="btn">Next</button>
    </section>

    <section id="stepOverview">
      <div class="step-title">Overview AI</div>
      <div id="aiOverview">Memuat overview AI…</div>
      <button id="overviewNext" class="btn">Lanjut ke Pemilihan Menu</button>
    </section>

    <section id="stepBreakfast">
      <div class="step-title">Sarapan (1 pilihan)</div>
      <div id="list-breakfast" class="food-list"></div>
      <button id="next-breakfast" class="btn" disabled>Next: Siang</button>
    </section>

    <section id="stepLunch">
      <div class="step-title">Makan Siang (1 pilihan)</div>
      <div id="list-lunch" class="food-list"></div>
      <button id="next-lunch" class="btn" disabled>Next: Malam</button>
    </section>

    <section id="stepDinner">
      <div class="step-title">Makan Malam (1 pilihan)</div>
      <div id="list-dinner" class="food-list"></div>
      <button id="next-dinner" class="btn" disabled>Lihat Ringkasan</button>
    </section>

    <section id="stepReview">
      <div class="step-title">Ringkasan Pilihan</div>
      <div class="summary">
        <strong>Sarapan:</strong> <span id="sel-breakfast"></span><br>
        <strong>Siang:</strong> <span id="sel-lunch"></span><br>
        <strong>Malam:</strong> <span id="sel-dinner"></span>
      </div>
      <button id="btnReview" class="btn">Dapatkan Review AI</button>
      <div id="aiReview">Menunggu...</div>
    </section>
  </div>

  <div id="spinner" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const surveyQs = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi makanan junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur sayuran?",
      "6. Sebutkan makanan yang bergizi dan tidak bergizi",
      "7. Menurut kamu makanan bergizi penting atau tidak bagi manusia?",
      "8. Sayur sayuran dan buah buahan apakah termasuk makanan bergizi?",
      "9. Apakah kamu hari ini sudah sarapan?",
      "10. Mengapa kebanyakan orang lebih suka mengonsumsi makanan junk food atau yang mengandung banyak minyak seperti gorengan?"
    ];
    const foods = [
      "Nasi Goreng","Soto Ayam","Rendang","Bakso","Mie Goreng","Pecel Lele",
      "Ayam Goreng","Pempek","Gado Gado","Ketoprak","Lontong Sayur","Soto Betawi",
      "Martabak Telor","Martabak Manis","Bubur Ayam","Nasi Padang","Nasi Uduk","Es Campur",
      "Scrambled Eggs","Pancakes","Grilled Chicken","Caesar Salad","Spaghetti Bolognese",
      "Mashed Potatoes","Beef Steak","French Toast","Omelette","Chicken Sandwich",
      "Shawarma","Falafel","Hummus & Pita","Kebab","Biryani","Roti Canai",
      "Chicken Tikka","Lamb Kofta","Tabbouleh","Samosa"
    ];
    let si = 0, sa = [], sel = {};

    // refs
    const refs = {
      stepSurvey: document.getElementById("stepSurvey"),
      stepOverview: document.getElementById("stepOverview"),
      stepBreakfast: document.getElementById("stepBreakfast"),
      stepLunch: document.getElementById("stepLunch"),
      stepDinner: document.getElementById("stepDinner"),
      stepReview: document.getElementById("stepReview"),
      surveyQ: document.getElementById("surveyQ"),
      surveyA: document.getElementById("surveyA"),
      surveyNext: document.getElementById("surveyNext"),
      aiOverview: document.getElementById("aiOverview"),
      overviewNext: document.getElementById("overviewNext"),
      listBreakfast: document.getElementById("list-breakfast"),
      listLunch: document.getElementById("list-lunch"),
      listDinner: document.getElementById("list-dinner"),
      nextBreakfast: document.getElementById("next-breakfast"),
      nextLunch: document.getElementById("next-lunch"),
      nextDinner: document.getElementById("next-dinner"),
      selB: document.getElementById("sel-breakfast"),
      selL: document.getElementById("sel-lunch"),
      selD: document.getElementById("sel-dinner"),
      btnReview: document.getElementById("btnReview"),
      aiReview: document.getElementById("aiReview"),
      spinner: document.getElementById("spinner"),
      mainCon: document.getElementById("mainContainer")
    };

    function renderSurvey(i) {
      refs.surveyQ.textContent = surveyQs[i];
      refs.surveyA.value = "";
      refs.surveyNext.textContent =
        i < surveyQs.length - 1 ? "Next" : "Submit";
    }
    renderSurvey(si);

    refs.surveyNext.onclick = async () => {
      const v = refs.surveyA.value.trim();
      if (!v) return alert("Isi jawaban.");
      sa[si] = v;
      if (si < surveyQs.length - 1) {
        si++; renderSurvey(si);
      } else {
        confetti({ particleCount: 100, spread: 60, origin: { y: 0.4 } });
        refs.stepSurvey.classList.replace("active", "hidden");
        refs.stepOverview.classList.add("active");
        refs.spinner.classList.add("active");
        refs.aiOverview.textContent = "Memuat overview AI…";
        const prompt = sa.map((a,i)=>${surveyQs[i]} ${a}).join("\n");
        try {
          const res = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            }
          );
          const j = await res.json();
          let t = j.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal.";
          refs.aiOverview.innerHTML = t.replace(/\\/g,"").replace(/\n/g,"<br>");
        } catch {
          refs.aiOverview.textContent = "Error AI.";
        } finally {
          refs.spinner.classList.remove("active");
        }
      }
    };

    refs.overviewNext.onclick = () => {
      refs.stepOverview.classList.replace("active", "hidden");
      refs.stepBreakfast.classList.add("active");
      refs.mainCon.classList.add("wide");
      setupMeal("breakfast", refs.listBreakfast, refs.nextBreakfast);
      setupMeal("lunch",     refs.listLunch,     refs.nextLunch);
      setupMeal("dinner",    refs.listDinner,    refs.nextDinner);
    };

    function setupMeal(type, listEl, btnEl) {
      foods.forEach(name => {
        const d = document.createElement("div");
        d.className = "food-item";
        d.textContent = name;
        d.onclick = () => {
          listEl.querySelectorAll(".food-item").forEach(el => el.classList.remove("selected"));
          sel[type] = name;
          d.classList.add("selected");
          btnEl.disabled = false;
        };
        listEl.append(d);
      });
    }

    refs.nextBreakfast.onclick = () => {
      refs.stepBreakfast.classList.replace("active", "hidden");
      refs.stepLunch.classList.add("active");
    };
    refs.nextLunch.onclick = () => {
      refs.stepLunch.classList.replace("active", "hidden");
      refs.stepDinner.classList.add("active");
    };
    refs.nextDinner.onclick = () => {
      refs.stepDinner.classList.replace("active", "hidden");
      refs.selB.textContent = sel.breakfast;
      refs.selL.textContent = sel.lunch;
      refs.selD.textContent = sel.dinner;
      refs.stepReview.classList.add("active");
    };

    refs.btnReview.onclick = async () => {
      refs.spinner.classList.add("active");
      const prompt =
        Tinjau menu saya dan hitung total kalori:\n +
        Sarapan: ${sel.breakfast}\n +
        Makan siang: ${sel.lunch}\n +
        Makan malam: ${sel.dinner}\n +
        Bandingkan dengan kisaran harian sehat (2000–2500 kkal) dan jawab tanpa bold.;
      try {
        const res = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
          }
        );
        const j = await res.json();
        let t = j.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal.";
        refs.aiReview.innerHTML = t.replace(/\\/g,"").replace(/\n/g,"<br>");
      } catch {
        refs.aiReview.textContent = "Error AI.";
      } finally {
        refs.spinner.classList.remove("active");
      }
    };
  });
  </script>
</body>
</html>
