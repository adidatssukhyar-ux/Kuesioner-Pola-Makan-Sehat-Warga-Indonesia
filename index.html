<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pola Makan Sehat Orang Indonesia</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* AI Overview styling to match form */
    #aiOverview {
      display: none;
      margin-top: 12px;
      padding: 14px 16px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: linear-gradient(135deg, #ffffff, #f7f7f7);
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      font-size: 14px;
      line-height: 1.5em;
      color: #333;
      animation: fadeInUp 0.4s ease;
    }
    #aiOverview strong {
      display: block;
      margin-bottom: 6px;
      font-size: 15px;
      color: #222;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pola Makan Sehat Orang Indonesia</h1>
    <form id="wizardForm">
      <label for="email">Email kamu:</label>
      <input type="email" name="email" id="email" required placeholder="your@email.com">
      <div id="questionContainer"></div>
      <button type="button" id="nextBtn">Next</button>
      <button type="submit" id="submitBtn" style="display:none;">Kirim</button>
    </form>

    <div id="thankYouMessage" style="display:none; cursor:pointer; margin-top:12px;">
      <span>Terimakasih telah menjawab, hasil anda akan dikirim ke email dalam waktu yang singkat</span><br>
      <span id="hiddenInfo" style="display:none; color:gray;">(maybe 2 days)</span>
    </div>

    <!-- AI Overview -->
    <div id="aiOverview"></div>

    <hr>
    <button id="showAnswersBtn" type="button">📋 Lihat Semua Jawaban</button>
    <div id="answersContainer" style="display:none; margin-top:10px;"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGxE7jKysNL097Ip_8_Xjr7pid3XNPCZY",
      authDomain: "surveylive-c0691.firebaseapp.com",
      projectId: "surveylive-c0691",
      storageBucket: "surveylive-c0691.firebasestorage.app",
      messagingSenderId: "894041077720",
      appId: "1:894041077720:web:2115a27b69e8b81ab724ad",
      measurementId: "G-83GZWBY7K5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const questions = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi makanan junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur sayuran?",
      "6. Sebutkan makanan yang bergizi dan tidak bergizi",
      "7. Menurut kamu makanan bergizi penting atau tidak bagi manusia?",
      "8. Sayur sayuran dan buah buahan apakah termasuk makanan bergizi?",
      "9. Apakah kamu hari ini sudah sarapan?",
      "10. Mengapa kebanyakan orang lebih suka mengonsumsi makanan junk food atau yang mengandung banyak minyak seperti gorengan?"
    ];

    let currentQuestion = 0;
    let tempAnswers = [];
    let allAnswers = JSON.parse(localStorage.getItem("responses") || "[]");

    const emailInput = document.getElementById('email');
    const questionContainer = document.getElementById('questionContainer');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const thankYouMessage = document.getElementById('thankYouMessage');
    const hiddenInfo = document.getElementById('hiddenInfo');
    const aiOverview = document.getElementById('aiOverview');
    const form = document.getElementById('wizardForm');
    const showAnswersBtn = document.getElementById('showAnswersBtn');
    const answersContainer = document.getElementById('answersContainer');

    function showQuestion(index) {
      questionContainer.innerHTML = `
        <label for="answer">${questions[index]}</label>
        <textarea id="answer" placeholder="Jawaban kamu..."></textarea>
      `;
      if (index === questions.length - 1) {
        nextBtn.style.display = "none";
        submitBtn.style.display = "inline-block";
      } else {
        nextBtn.style.display = "inline-block";
        submitBtn.style.display = "none";
      }
    }

    showQuestion(currentQuestion);

    nextBtn.addEventListener('click', () => {
      const answerField = document.getElementById('answer');
      if (!emailInput.value.trim() || !answerField.value.trim()) return;
      tempAnswers[currentQuestion] = answerField.value.trim();
      currentQuestion++;
      showQuestion(currentQuestion);
    });

    function generateOverview(answers = []) {
      const a = (i) => (answers[i] || "").toLowerCase();
      let parts = [];

      if (a(0).includes("sehat")) {
        parts.push("⚠️ Kamu menilai junk food sebagai makanan sehat. Perlu diingat, makanan cepat saji biasanya tinggi lemak jenuh, garam, dan gula. Menguranginya akan membantu menjaga kesehatan jangka panjang.");
      } else if (a(0)) {
        parts.push("👍 Kesadaran kamu bahwa junk food tidak sehat adalah langkah awal yang baik. Pertahankan pilihan ini untuk kesehatan yang lebih baik.");
      }

      if (a(3).includes("sering")) {
        parts.push("🥤 Kebiasaan sering minum soda atau minuman manis dapat meningkatkan risiko obesitas dan masalah gigi. Cobalah menggantinya dengan air putih atau infused water.");
      } else if (a(3)) {
        parts.push("💧 Pilihan minuman kamu sudah cukup sehat. Teruskan kebiasaan ini untuk menjaga hidrasi dan kesehatan tubuh.");
      }

      if (a(4).includes("tidak") || a(4).includes("jarang")) {
        parts.push("🥦 Asupan sayur dan buah kamu masih kurang. Menambahkannya setiap hari akan membantu memenuhi kebutuhan serat, vitamin, dan mineral.");
      } else if (a(4)) {
        parts.push("🌱 Konsumsi sayur dan buah kamu sudah baik. Pertahankan variasi dan jumlahnya untuk manfaat maksimal.");
      }

      if (a(8).includes("tidak")) {
        parts.push("🍳 Melewatkan sarapan dapat membuat energi menurun dan konsentrasi terganggu. Usahakan sarapan dengan menu bergizi setiap pagi.");
      } else if (a(8)) {
        parts.push("☀️ Sarapan teratur membantu menjaga energi dan fokus sepanjang hari. Pertahankan kebiasaan baik ini.");
      }

      parts.push("💡 Secara keseluruhan, pola makan seimbang, cukup air, dan olahraga teratur akan membantu menjaga tubuh tetap sehat dan bugar. Perubahan kecil yang konsisten dapat memberikan hasil besar dalam jangka panjang.");

      return `<strong>📊 Ringkasan & Saran:</strong>${parts.map(p => `<div>${p}</div>`).join("")}`;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const answerField = document.getElementById('answer');
      if (!answerField.value.trim()) return;
      tempAnswers[currentQuestion] = answerField.value.trim();

      allAnswers.push({ email: emailInput.value.trim(), answers: [...tempAnswers] });
      localStorage.setItem("responses", JSON.stringify(allAnswers));

      try {
        await addDoc(collection(db, "responses"), {
          email: emailInput.value.trim(),
          answers: [...tempAnswers],
          timestamp: new Date()
        });
      } catch (err) {
        alert("⚠ Data disimpan lokal. Firebase gagal menyimpan.");
