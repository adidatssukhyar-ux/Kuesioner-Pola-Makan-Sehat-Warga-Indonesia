<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pola Makan Sehat Orang Indonesia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- your OG stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- ml5.js & Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.6.0/dist/ml5.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

  <!-- Our controller script runs after parsing -->
  <script defer>
  //–– Configuration
  const questions = [
    "1. Menurut kamu makanan junk food sehat atau tidak?",
    "2. Seberapa sering kamu mengonsumsi junk food?",
    "3. Berapa kali kamu makan dalam sehari?",
    "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
    "5. Apakah kamu sering mengonsumsi sayur-sayuran?",
    "6. Sebutkan makanan yang bergizi dan tidak bergizi.",
    "7. Menurut kamu makanan bergizi penting atau tidak?",
    "8. Buah & sayur termasuk makanan bergizi?",
    "9. Apakah kamu hari ini sudah sarapan?",
    "10. Mengapa orang suka junk food?"
  ];
  let idx = 0, answers = [];

  document.addEventListener("DOMContentLoaded", () => {
    console.log("⚙️ Wizard init");

    // DOM refs
    const Qc      = document.getElementById("questionContainer");
    const nextBtn = document.getElementById("nextBtn");
    const subBtn  = document.getElementById("submitBtn");
    const viewBtn = document.getElementById("viewAnswersBtn");
    const delBtn  = document.getElementById("deleteLastBtn");
    const form    = document.getElementById("surveyForm");
    const emailIn = document.getElementById("email");
    const survey  = document.getElementById("surveySection");
    const results = document.getElementById("resultsSection");

    // Render one question
    function showQuestion(i) {
      console.log("Showing question", i);
      Qc.innerHTML = `
        <label>${questions[i]}</label>
        <textarea id="answer" placeholder="Jawaban kamu..."></textarea>
      `;
      if (i === questions.length - 1) {
        nextBtn.setAttribute("hidden", "");
        subBtn.removeAttribute("hidden");
      } else {
        nextBtn.removeAttribute("hidden");
        subBtn.setAttribute("hidden", "");
      }
    }

    // Initial kick-off
    showQuestion(0);

    // Next button
    nextBtn.addEventListener("click", () => {
      const val = document.getElementById("answer").value.trim();
      if (!val) return alert("Isi jawaban dulu!");
      answers.push(val);
      idx++;
      showQuestion(idx);
    });

    // View all answers
    viewBtn.addEventListener("click", () => {
      if (!answers.length) return alert("Belum ada jawaban.");
      const summary = answers
        .map((a,i) => `${i+1}. ${questions[i]}\nJawaban: ${a}`)
        .join("\n\n");
      alert("Ringkasan Jawaban:\n\n" + summary);
    });

    // Delete last answer
    delBtn.addEventListener("click", () => {
      if (!answers.length) return alert("Belum ada jawaban untuk dihapus.");
      answers.pop();
      idx = Math.max(0, idx - 1);
      showQuestion(idx);
      alert(`Jawaban ke-${idx+1} dihapus.`);
    });

    // Submit survey
    form.addEventListener("submit", e => {
      e.preventDefault();
      const last = document.getElementById("answer").value.trim();
      if (last) answers.push(last);
      if (!emailIn.value.trim() || answers.length < questions.length) {
        return alert("Isi email & semua pertanyaan dulu.");
      }
      console.log("All answers", answers);

      // Swap sections
      survey.setAttribute("hidden", "");
      results.removeAttribute("hidden");

      // Build food DB, photo logic, etc… (left intact)
      buildFoodList();
    });

    // …rest of your ML5.js + Chart.js + Gemini + Food-DB code goes here…
    // make sure it’s all inside this same DOMContentLoaded block.

  });
  </script>
</head>
<body>
  <div class="container">
    <h1>Pola Makan Sehat Orang Indonesia</h1>

    <!-- SURVEY -->
    <section id="surveySection">
      <form id="surveyForm" autocomplete="off">
        <label for="email">Email kamu:</label>
        <input type="email" id="email" />
        <div id="questionContainer"></div>
        <div class="button-group">
          <button type="button" id="viewAnswersBtn">Lihat Jawaban</button>
          <button type="button" id="deleteLastBtn">Hapus Jawaban Terakhir</button>
          <button type="button" id="nextBtn">Next</button>
          <button type="submit" id="submitBtn" hidden>Kirim</button>
        </div>
      </form>
    </section>

    <!-- RESULTS (hidden until submit) -->
    <section id="resultsSection" hidden>
      <!-- your same photo analysis + food-DB markup -->
    </section>
  </div>
</body>
</html>
