<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pola Makan Sehat Orang Indonesia</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Pola Makan Sehat Orang Indonesia</h1>
    <form id="wizardForm">
      <div id="emailStep">
        <label for="email">Email kamu:</label>
        <input type="email" name="email" id="email" required placeholder="your@email.com">
        <button type="button" id="startBtn">Next</button>
      </div>
      <div id="questionStep" style="display:none;">
        <div id="questionContainer"></div>
        <button type="button" id="nextBtn">Next</button>
        <button type="submit" id="submitBtn" style="display:none;">Kirim</button>
      </div>
    </form>

    <div id="thankYouMessage" style="display:none; margin-top:15px; cursor:pointer;">
      <span>Terimakasih telah menjawab, hasil anda akan dikirim ke email dalam waktu yang singkat</span><br>
      <span id="hiddenInfo" style="display:none; color:gray;">(maybe 2 days)</span>
    </div>

    <div id="aiOverview" style="display:none; margin-top:15px; padding:10px; border:1px solid #ccc; border-radius:5px; background:#f9f9f9;"></div>

    <hr>
    <button id="showAnswersBtn" type="button">üìã Lihat Semua Jawaban</button>
    <div id="answersContainer" style="display:none; margin-top:10px;"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } 
      from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAGxE7jKysNL097Ip_8_Xjr7pid3XNPCZY",
      authDomain: "surveylive-c0691.firebaseapp.com",
      projectId: "surveylive-c0691",
      storageBucket: "surveylive-c0691.firebasestorage.app",
      messagingSenderId: "894041077720",
      appId: "1:894041077720:web:2115a27b69e8b81ab724ad",
      measurementId: "G-83GZWBY7K5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const questions = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi makanan junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur sayuran?",
      "6. Sebutkan makanan yang bergizi dan tidak bergizi",
      "7. Menurut kamu makanan bergizi penting atau tidak bagi manusia?",
      "8. Sayur sayuran dan buah buahan apakah termasuk makanan bergizi?",
      "9. Apakah kamu hari ini sudah sarapan?",
      "10. Mengapa kebanyakan orang lebih suka mengonsumsi makanan junk food atau yang mengandung banyak minyak seperti gorengan?"
    ];

    let currentQuestion = 0;
    let tempAnswers = [];
    let allAnswers = JSON.parse(localStorage.getItem("responses") || "[]");

    const emailInput = document.getElementById('email');
    const startBtn = document.getElementById('startBtn');
    const emailStep = document.getElementById('emailStep');
    const questionStep = document.getElementById('questionStep');
    const questionContainer = document.getElementById('questionContainer');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const thankYouMessage = document.getElementById('thankYouMessage');
    const hiddenInfo = document.getElementById('hiddenInfo');
    const aiOverview = document.getElementById('aiOverview');
    const form = document.getElementById('wizardForm');
    const showAnswersBtn = document.getElementById('showAnswersBtn');
    const answersContainer = document.getElementById('answersContainer');

    function showQuestion(index) {
      questionContainer.innerHTML = `
        <label for="answer">${questions[index]}</label>
        <textarea id="answer" placeholder="Jawaban kamu..."></textarea>
      `;
      if (index === questions.length - 1) {
        nextBtn.style.display = "none";
        submitBtn.style.display = "inline-block";
      } else {
        nextBtn.style.display = "inline-block";
        submitBtn.style.display = "none";
      }
    }

    startBtn.addEventListener('click', () => {
      if (!emailInput.value.trim()) return alert("Masukkan email terlebih dahulu");
      emailStep.style.display = 'none';
      questionStep.style.display = 'block';
      currentQuestion = 0;
      tempAnswers = [];
      showQuestion(currentQuestion);
    });

    nextBtn.addEventListener('click', () => {
      const answerField = document.getElementById('answer');
      if (!answerField.value.trim()) return;
      tempAnswers[currentQuestion] = answerField.value.trim();
      currentQuestion++;
      showQuestion(currentQuestion);
    });

    function generateOverview(answers) {
      let advice = [];
      if (answers[0]?.toLowerCase().includes("sehat")) {
        advice.push("‚ö†Ô∏è Kamu menganggap junk food sehat ‚Äî sebaiknya batasi konsumsi makanan cepat saji.");
      } else {
        advice.push("üëç Bagus! Kamu sadar junk food tidak sehat.");
      }
      if (answers[4]?.toLowerCase().includes("tidak") || answers[4]?.toLowerCase().includes("jarang")) {
        advice.push("ü•¶ Perbanyak konsumsi sayur dan buah.");
      } else {
        advice.push("üå± Konsumsi sayur dan buah kamu sudah baik.");
      }
      if (answers[3]?.toLowerCase().includes("sering")) {
        advice.push("ü•§ Kurangi minuman manis/bersoda.");
      } else {
        advice.push("üíß Pilihan minuman kamu sehat.");
      }
      if (answers[8]?.toLowerCase().includes("tidak")) {
        advice.push("üç≥ Usahakan sarapan setiap pagi.");
      } else {
        advice.push("‚òÄÔ∏è Bagus! Sarapan teratur membantu energi.");
      }
      advice.push("üí° Pola makan seimbang + olahraga teratur = tubuh sehat.");
      return advice.join("<br>");
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const answerField = document.getElementById('answer');
      if (!answerField.value.trim()) return;
      tempAnswers[currentQuestion] = answerField.value.trim();

      allAnswers.push({ email: emailInput.value.trim(), answers: [...tempAnswers] });
      localStorage.setItem("responses", JSON.stringify(allAnswers));

      try {
        await addDoc(collection(db, "responses"), {
          email: emailInput.value.trim(),
          answers: [...tempAnswers],
          timestamp: new Date()
        });
      } catch (err) {
        alert("‚ö† Data disimpan lokal. Firebase gagal menyimpan.");
      }

      thankYouMessage.style.display = 'block';
      aiOverview.innerHTML = `<strong>üìä Ringkasan & Saran:</strong><br>${generateOverview(tempAnswers)}`;
      aiOverview.style.display = 'block';

      // Reset to email step for next person
      questionStep.style.display = 'none';
      emailStep.style.display = 'block';
      form.reset();
    });

    thankYouMessage.addEventListener('click', () => {
      hiddenInfo.style.display = 'inline';
    });

    showAnswersBtn.addEventListener('click', async () => {
      const pass = prompt("Masukkan password untuk melihat jawaban
