```html
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pola Makan Sehat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ML5.js, Chart.js & Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.6.0/dist/ml5.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>

  <style>
    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg,#e5ffe5 0%,#fffbe5 100%);
      color: #333;
    }
    .container {
      max-width: 500px;
      margin: 60px auto;
      padding: 30px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 20px rgba(100,180,120,0.12);
      transition: max-width .3s;
    }
    .container.wide { max-width: 90%; }

    /* Logo & Credit */
    .header-logo img {
      display: block;
      margin: 0 auto;
      width: 80px;
      border-radius: 8px;
    }
    .project-credit {
      text-align: center;
      color: #666;
      margin: 8px 0 24px;
      font-size: 0.9em;
    }

    h1, h2 {
      text-align: center;
      color: #35a35c;
      margin: 0 0 12px;
    }
    h1 { font-size: 2em; letter-spacing: 1px; }
    h2 { font-size: 1.4em; }

    /* Sections */
    section {
      display: none;
      animation: fadeIn .4s ease;
    }
    section.active { display: block; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px) }
      to   { opacity: 1; transform: translateY(0)   }
    }

    /* Form */
    label {
      display: block;
      margin-top: 16px;
      font-weight: 600;
      color: #22753e;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 1.5px solid #f5bc51;
      border-radius: 8px;
      background: #fffde9;
      font-size: 1em;
      box-sizing: border-box;
      transition: border-color .2s;
    }
    input:focus, textarea:focus {
      border-color: #35a35c;
      outline: none;
    }
    textarea { min-height: 80px; resize: vertical; }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 13px;
      background: linear-gradient(90deg,#35a35c 40%,#f5bc51 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(53,163,92,0.08);
      transition: background .2s, box-shadow .2s;
    }
    button:hover {
      background: linear-gradient(90deg,#22753e 30%,#e9b742 100%);
      box-shadow: 0 4px 16px rgba(53,163,92,0.15);
    }

    .question-text {
      margin-top: 16px;
      font-size: 1.1em;
      font-weight: 600;
      color: #22753e;
    }

    /* Spinner */
    .spinner-overlay {
      position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(255,255,255,0.6);
      display: flex; align-items: center; justify-content: center;
      visibility: hidden; opacity: 0;
      transition: opacity .2s;
      z-index: 200;
    }
    .spinner-overlay.active {
      visibility: visible; opacity: 1;
    }
    .spinner {
      width: 50px; height: 50px;
      border: 6px solid #f5bc51;
      border-top-color: #35a35c;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg) } }

    /* Two-column layout */
    .analysis-flex {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    .analysis-photo, .analysis-list {
      flex: 1; min-width: 200px;
      position: relative;
    }

    /* Warning */
    .warning {
      margin-top: 16px;
      padding: 12px;
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffeeba;
      border-radius: 4px;
      display: flex; align-items: center;
    }
    .warning span { margin-left: 8px }

    /* Food list */
    .food-list {
      margin-top: 8px;
      max-height: 300px;
      overflow-y: auto;
      border: 1.5px solid #b5e7b7;
      border-radius: 8px;
      background: #fffde9;
    }
    .food-item {
      padding: 10px;
      border-bottom: 1px solid #e0e0e0;
      cursor: pointer;
    }
    .food-item:last-child { border-bottom: none; }
    .food-item:hover { background: rgba(53,163,92,0.1) }

    /* Detail panel */
    #foodDetailPanel {
      margin-top: 8px;
      border: 1px solid #b5e7b7;
      border-radius: 8px;
      background: #fff;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    #foodDetailPanel.hidden { display: none; }
    .close-btn {
      position: absolute; top: 8px; right: 8px;
      background: none; border: none;
      font-size: 1.2em; cursor: pointer; color: #666;
    }
    .close-btn:hover { color: #333 }

    /* Charts */
    .analysis-photo canvas {
      max-width: 100%;
      height: 150px;
      margin-top: 24px;
    }
  </style>
</head>

<body>
  <div class="container" id="mainContainer">
    <!-- Logo & Credit -->
    <div class="header-logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo"
           alt="Logo Sekolah Al Ikhlas">
    </div>
    <div class="project-credit">Karya Kelompok 1 — Proyek 1</div>

    <h1>Pola Makan Sehat</h1>

    <!-- STEP 1: Survey -->
    <section id="step1" class="active">
      <div id="questionContainer"></div>
      <button id="step1Next">Next</button>
    </section>

    <!-- STEP 2: AI Overview -->
    <section id="step2">
      <h2>Overview AI</h2>
      <div id="aiOverview" style="min-height:80px;"></div>
      <button id="step2Next">Lanjut ke Foto</button>
    </section>

    <!-- STEP 3: Photo Analysis & Food List -->
    <section id="step3">
      <h2>Analisis Foto & Makanan</h2>
      <div class="analysis-flex">
        <!-- Photo Analysis -->
        <div class="analysis-photo">
          <label for="imageUrl">URL Foto (opsional):</label>
          <input type="url" id="imageUrl" placeholder="https://..." />
          <label for="foodPhoto">Atau Pilih File:</label>
          <input type="file" id="foodPhoto" accept="image/*" />
          <button id="photoSubmit">Analisis Foto</button>

          <img id="foodPreview" class="hidden" alt="Preview"
               style="margin-top:16px;max-width:100%;border-radius:8px;
                      box-shadow:0 2px 12px rgba(0,0,0,0.1);" />

          <div id="warningSign" class="warning hidden">
            ⚠️ <span>Kalori terlalu rendah. Pertimbangkan menambah porsi.</span>
          </div>

          <div id="photoAnalysis" style="min-height:60px;margin-top:8px;"></div>
          <canvas id="macroPie"></canvas>
          <canvas id="macroBar"></canvas>
        </div>

        <!-- Food Search & List -->
        <div class="analysis-list">
          <h2>Analisis makanan yang Anda makan!</h2>
          <input type="text" id="foodSearchRight" placeholder="Cari makanan..." />
          <div id="foodDetailPanel" class="hidden"></div>
          <div id="foodListRight" class="food-list"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- Spinner Overlay -->
  <div id="spinner" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const questions = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur-sayuran?",
      "6. Sebutkan satu makanan bergizi dan satu yang tidak bergizi.",
      "7. Menurut kamu, seberapa penting nutrisi seimbang?",
      "8. Buah atau sayur mana yang paling sering kamu konsumsi?",
      "9. Apa tantanganmu untuk makan lebih sehat?",
      "10. Langkah apa yang akan kamu ambil untuk pola makan lebih baik?"
    ];
    const macroDBList = [
      {key:"apple",name:"Apel",protein:0.3,carbs:14,fats:0.2,energy:52},
      {key:"banana",name:"Pisang",protein:1.3,carbs:23,fats:0.3,energy:96},
      {key:"rice",name:"Nasi Putih",protein:2.7,carbs:28,fats:0.3,energy:130},
      {key:"sushi",name:"Sushi",protein:6,carbs:36,fats:1.5,energy:200},
      {key:"salad",name:"Salad",protein:2,carbs:5,fats:0.2,energy:35}
    ];
    const macroDB = Object.fromEntries(macroDBList.map(o=>[o.key,o]));

    let idx=0, answers=[];

    // DOM refs
    const secs       = {
      1: document.getElementById("step1"),
      2: document.getElementById("step2"),
      3: document.getElementById("step3")
    };
    const qC         = document.getElementById("questionContainer");
    const btn1       = document.getElementById("step1Next");
    const btn2       = document.getElementById("step2Next");
    const aiDiv      = document.getElementById("aiOverview");
    const spinner    = document.getElementById("spinner");
    const imgUrl     = document.getElementById("imageUrl");
    const fileInput  = document.getElementById("foodPhoto");
    const photoBtn   = document.getElementById("photoSubmit");
    const preview    = document.getElementById("foodPreview");
    const warnEl     = document.getElementById("warningSign");
    const analysis   = document.getElementById("photoAnalysis");
    const pieCan     = document.getElementById("macroPie");
    const barCan     = document.getElementById("macroBar");
    const foodList   = document.getElementById("foodListRight");
    const foodSearch = document.getElementById("foodSearchRight");
    const detailPan  = document.getElementById("foodDetailPanel");

    function showQuestion(i) {
      secs[1].classList.add("active");
      qC.innerHTML = `
        <p class="question-text">${questions[i]}</p>
        <textarea id="answer" placeholder="Tuliskan jawaban...">${answers[i]||""}</textarea>
      `;
      btn1.textContent = i < questions.length-1 ? "Next" : "Submit";
    }
    showQuestion(idx);

    btn1.addEventListener("click", async () => {
      const v = document.getElementById("answer").value.trim();
      if (!v) return alert("Isi jawaban dulu.");      answers[idx] = v;
      if (idx < questions.length-1) {
        idx++; showQuestion(idx);
      } else {
        confetti({ particleCount:100, spread:60, origin:{ y:0.3 } });
        secs[1].classList.replace("active","hidden");
        secs[2].classList.replace("hidden","active");

        aiDiv.innerHTML = "<p style='font-style:italic'>Memuat overview AI…</p>";
        spinner.classList.add("active");
        const prompt = answers.map((a,i)=>`${questions[i]}\nJawaban: ${a}`).join("\n\n");
        try {
          const res = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=YOUR_API_KEY`,
            {
              method:"POST",
              headers:{"Content-Type":"application/json"},
              body: JSON.stringify({
                contents:[{ parts:[{ text:`Ringkas pola makan:\n\n${prompt}` }] }]
              })
            }
          );
          const j = await res.json();
          aiDiv.innerHTML = `<p>${(j.candidates?.[0]?.content?.parts?.[0]?.text||"AI gagal").replace(/\n/g,"<br>")}</p>`;
        } catch {
          aiDiv.innerHTML = "<p style='color:red'>Error memuat AI overview.</p>";
        } finally {
          spinner.classList.remove("active");
        }
      }
    });

    btn2.addEventListener("click", () => {
      secs[2].classList.replace("active","hidden");
      secs[3].classList.replace("hidden","active");
      document.querySelector(".container").classList.add("wide");
      buildFoodList();
    });

    function buildFoodList() {
      detailPan.classList.add("hidden");
      foodSearch.value = "";
      foodList.innerHTML = "";
      macroDBList.forEach(item => {
        const div = document.createElement("div");
        div.className = "food-item";
        div.textContent = item.name;
        div.onclick = () => showFoodDetail(item);
        foodList.append(div);
      });
    }

    foodSearch.addEventListener("input", () => {
      const q = foodSearch.value.trim().toLowerCase();
      document.querySelectorAll(".food-item").forEach(el => {
        el.style.display = el.textContent.toLowerCase().includes(q) ? "" : "none";
      });
      detailPan.classList.add("hidden");
    });

    function showFoodDetail(item) {
      detailPan.innerHTML = `
        <button class="close-btn">&times;</button>
        <h3>${item.name}</h3>
        <p>Protein: ${item.protein} g</p>
        <p>Karbo: ${item.carbs} g</p>
        <p>Lemak: ${item.fats} g</p>
        <p>Energi: ${item.energy} kcal</p>
      `;
      detailPan.classList.remove("hidden");
      detailPan.querySelector(".close-btn").onclick = () => detailPan.classList.add("hidden");
    }

    photoBtn.addEventListener("click", async () => {
      let src = imgUrl.value.trim();
      if (!src && fileInput.files[0]) src = URL.createObjectURL(fileInput.files[0]);
      if (!src) return alert("Masukkan URL atau pilih file gambar dulu.");

      preview.src = src;
      preview.classList.remove("hidden");
      warnEl.classList.add("hidden");
      analysis.textContent = "";
      spinner.classList.add("active");

      const classifier = await ml5.imageClassifier("MobileNet");
      const [res] = await classifier.classify(preview);
      const key = res.label.split(",")[0].toLowerCase();
      const info = macroDB[key] || { name:key, protein:0, carbs:0, fats:0, energy:0 };

      if (info.energy < 150) warnEl.classList.remove("hidden");

      const totalM = info.protein + info.carbs + info.fats;
      const pctP = totalM ? Math.round(info.protein/totalM*100) : 0;
      const pctC = totalM ? Math.round(info.carbs/totalM*100) : 0;
      const pctF = totalM ? Math.round(info.fats/totalM*100) : 0;

      renderPie([pctP,pctC,pctF], ["Protein","Karbo","Lemak"], pieCan);
      renderBar(
        [info.protein,info.carbs,info.fats,info.energy],
        ["Protein(g)","Karbo(g)","Lemak(g)","Energi(kcal)"],
        barCan
      );

      analysis.innerHTML = `
        <p><strong>${info.name}</strong>: ${info.energy} kcal,
        ${info.protein}g P, ${info.carbs}g C, ${info.fats}g L</p>
      `;

      spinner.classList.remove("active");
    });

    function clearChart(c) {
      if (c._chart) c._chart.destroy();
    }
    function renderPie(data, labels, canvas) {
      clearChart(canvas);
      canvas._chart = new Chart(canvas.getContext("2d"), {
        type: "pie",
        data: { labels, datasets:[{ data, backgroundColor:["#35a35c","#f5bc51","#e57373"] }]},
        options:{ responsive:true, animation:{ animateScale:true, duration:800, easing:"easeOutQuad" }, plugins:{ legend:{ position:"bottom" }}}
      });
    }
    function renderBar(data, labels, canvas) {
      clearChart(canvas);
      canvas._chart = new Chart(canvas.getContext("2d"), {
        type: "bar",
        data:{ labels, datasets:[{ label:"Jumlah", data, backgroundColor:["#35a35c","#f5bc51","#e57373","#5c97f5"] }]},
        options:{ indexAxis:"y", responsive:true, animation:{ duration:1000, easing:"easeOutBounce" }}
      });
    }
  });
  </script>
</body>
</html>
```
