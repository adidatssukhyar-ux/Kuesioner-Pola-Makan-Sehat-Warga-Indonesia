<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pola Makan Sehat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>
  <style>
    :root {
      --primary: #35a35c;
      --accent:  #5c97f5;
      --mid:     #f5bc51;
      --card:    #ffffff;
      --text:    #333333;
      --muted:   #777777;
      --radius:  12px;
      --shadow:  0 4px 20px rgba(0,0,0,0.05);
      --transition: 0.4s ease;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: "Segoe UI", sans-serif;
      color: var(--text);
      padding: 20px;
      background: linear-gradient(
        120deg,
        var(--primary),
        var(--accent),
        var(--mid)
      );
      background-size: 600% 600%;
      animation: gradientShift 16s ease infinite;
    }
    @keyframes gradientShift {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .container {
      max-width: 540px;
      margin: auto;
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: max-width var(--transition);
    }
    .container.wide {
      max-width: 90%;
    }
    .logo {
      background: var(--primary);
      text-align: center;
      padding: 16px;
    }
    .logo img {
      width: 60px;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      margin: 16px 0;
      color: var(--primary);
    }
    section {
      display: none;
      padding: 24px;
    }
    section.active {
      display: block;
    }
    .step-title,
    .question-text {
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 12px;
    }
    .step-title {
      font-size: 1.1rem;
    }
    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #cdefe1;
      border-radius: var(--radius);
      font-size: 1rem;
      resize: vertical;
    }
    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin-top: 24px;
      background: var(--primary);
      color: #ffffff;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
    }
    .btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    .btn:not(:disabled):hover {
      background: var(--accent);
      transform: translateY(-2px);
    }
    .search-input {
      width: 100%;
      padding: 10px 12px;
      margin-bottom: 12px;
      border: 1px solid #cdefe1;
      border-radius: var(--radius);
      font-size: 1rem;
    }
    .food-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 12px;
    }
    .food-item {
      padding: 10px;
      background: #fcfcfc;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
      text-align: center;
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition);
    }
    .food-item.selected {
      background: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
    }
    .no-result {
      grid-column: 1 / -1;
      padding: 12px;
      text-align: center;
      color: var(--muted);
    }
    .summary {
      background: #fcfcfc;
      padding: 16px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
    }
    #aiOverview,
    #aiReview {
      min-height: 100px;
      padding: 16px;
      border: 1px solid #e0e0e0;
      border-radius: var(--radius);
      background: #ffffff;
      line-height: 1.6;
      margin-bottom: 16px;
    }
    .spinner-overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      z-index: 1000;
    }
    .spinner-overlay.active {
      visibility: visible;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #e0e0e0;
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container" id="mainContainer">
    <div class="logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo" alt="Logo">
    </div>
    <h1>Pola Makan Sehat</h1>

    <!-- Survey -->
    <section id="stepSurvey" class="active">
      <div class="step-title">Survey Singkat</div>
      <div class="question-text" id="surveyQ"></div>
      <textarea id="surveyA" rows="3" placeholder="Tuliskan jawaban…"></textarea>
      <button id="surveyNext" class="btn">Next</button>
    </section>

    <!-- AI Overview -->
    <section id="stepOverview">
      <div class="step-title">Overview AI</div>
      <div id="aiOverview">Memuat overview AI…</div>
      <button id="overviewNext" class="btn">Lanjut ke Pemilihan Menu</button>
    </section>

    <!-- Breakfast -->
    <section id="stepBreakfast">
      <div class="step-title">Sarapan: Pilih 1 Main & 1 Side</div>
      <input id="search-breakfast-main" class="search-input" placeholder="Cari main dish…" />
      <div id="list-breakfast-main" class="food-list"></div>
      <input id="search-breakfast-side" class="search-input" placeholder="Cari side dish…" />
      <div id="list-breakfast-side" class="food-list"></div>
      <button id="next-breakfast" class="btn" disabled>Next: Siang</button>
    </section>

    <!-- Lunch -->
    <section id="stepLunch">
      <div class="step-title">Makan Siang: Pilih 1 Main & 1 Side</div>
      <input id="search-lunch-main" class="search-input" placeholder="Cari main dish…" />
      <div id="list-lunch-main" class="food-list"></div>
      <input id="search-lunch-side" class="search-input" placeholder="Cari side dish…" />
      <div id="list-lunch-side" class="food-list"></div>
      <button id="next-lunch" class="btn" disabled>Next: Malam</button>
    </section>

    <!-- Dinner -->
    <section id="stepDinner">
      <div class="step-title">Makan Malam: Pilih 1 Main & 1 Side</div>
      <input id="search-dinner-main" class="search-input" placeholder="Cari main dish…" />
      <div id="list-dinner-main" class="food-list"></div>
      <input id="search-dinner-side" class="search-input" placeholder="Cari side dish…" />
      <div id="list-dinner-side" class="food-list"></div>
      <button id="next-dinner" class="btn" disabled>Lihat Ringkasan</button>
    </section>

    <!-- Review -->
    <section id="stepReview">
      <div class="step-title">Ringkasan Pilihan</div>
      <div class="summary">
        <strong>Sarapan:</strong> <span id="sel-breakfast"></span><br>
        <strong>Siang:</strong> <span id="sel-lunch"></span><br>
        <strong>Malam:</strong> <span id="sel-dinner"></span>
      </div>
      <button id="btnReview" class="btn">Dapatkan Review AI</button>
      <div id="aiReview">Menunggu...</div>
    </section>
  </div>

  <div id="spinner" class="spinner-overlay"><div class="spinner"></div></div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const surveyQs = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi makanan junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda/minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur sayuran?",
      "6. Sebutkan makanan yang bergizi dan tidak bergizi",
      "7. Menurut kamu makanan bergizi penting atau tidak bagi manusia?",
      "8. Sayur sayuran dan buah buahan apakah termasuk makanan bergizi?",
      "9. Apakah kamu hari ini sudah sarapan?",
      "10. Mengapa kebanyakan orang lebih suka mengonsumsi makanan junk food atau yang mengandung banyak minyak seperti gorengan?"
    ];

    const mains = [
      "Nasi Goreng","Soto Ayam","Rendang","Bakso","Mie Goreng","Pecel Lele",
      "Ayam Goreng","Pempek","Gado Gado","Ketoprak","Lontong Sayur","Soto Betawi",
      "Martabak Telor","Martabak Manis","Bubur Ayam","Nasi Padang","Nasi Uduk","Es Campur",
      "Scrambled Eggs","Pancakes","Grilled Chicken","Caesar Salad","Spaghetti Bolognese",
      "Beef Steak","Chicken Sandwich","Shawarma","Falafel","Biryani","Roti Canai",
      "Chicken Tikka","Lamb Kofta","Tabbouleh","Samosa"
    ];

    const sides = [
      "Nasi Putih","Kentang Goreng","Mashed Potatoes","Sayur Bening","Sambal",
      "Kerupuk","Tempe Goreng","Tahu Goreng","Salad Buah","Urap Sayur",
      "Kentang Rebus","Kentang Panggang","Oatmeal","Roti Tawar","Polenta",
      "Quinoa","Kuskus","Jagung Rebus","Tumis Brokoli","Kentang Hasselback"
    ];

    let si = 0, sa = [], selMain = {}, selSide = {};

    const refs = id => document.getElementById(id);

    const R = {
      stepSurvey: refs("stepSurvey"),
      stepOverview: refs("stepOverview"),
      stepBreakfast: refs("stepBreakfast"),
      stepLunch: refs("stepLunch"),
      stepDinner: refs("stepDinner"),
      stepReview: refs("stepReview"),
      surveyQ: refs("surveyQ"),
      surveyA: refs("surveyA"),
      surveyNext: refs("surveyNext"),
      aiOverview: refs("aiOverview"),
      overviewNext: refs("overviewNext"),
      spinner: refs("spinner"),
      mainCon: refs("mainContainer"),
      // breakfast
      searchBreakfastMain: refs("search-breakfast-main"),
      listBreakfastMain: refs("list-breakfast-main"),
      searchBreakfastSide: refs("search-breakfast-side"),
      listBreakfastSide: refs("list-breakfast-side"),
      nextBreakfast: refs("next-breakfast"),
      // lunch
      searchLunchMain: refs("search-lunch-main"),
      listLunchMain: refs("list-lunch-main"),
      searchLunchSide: refs("search-lunch-side"),
      listLunchSide: refs("list-lunch-side"),
      nextLunch: refs("next-lunch"),
      // dinner
      searchDinnerMain: refs("search-dinner-main"),
      listDinnerMain: refs("list-dinner-main"),
      searchDinnerSide: refs("search-dinner-side"),
      listDinnerSide: refs("list-dinner-side"),
      nextDinner: refs("next-dinner"),
      // review
      selB: refs("sel-breakfast"),
      selL: refs("sel-lunch"),
      selD: refs("sel-dinner"),
      btnReview: refs("btnReview"),
      aiReview: refs("aiReview")
    };

    // Survey render
    function renderSurvey(i) {
      R.surveyQ.textContent = surveyQs[i];
      R.surveyA.value = "";
      R.surveyNext.textContent = i < surveyQs.length - 1 ? "Next" : "Submit";
    }
    renderSurvey(si);

    R.surveyNext.onclick = async () => {
      const v = R.surveyA.value.trim();
      if (!v) return alert("Isi jawaban.");
      sa[si] = v;
      if (si < surveyQs.length - 1) {
        si++;
        renderSurvey(si);
      } else {
        confetti({ particleCount:100, spread:60, origin:{ y:0.4 } });
        R.stepSurvey.classList.replace("active","hidden");
        R.mainCon.classList.add("wide");
        R.stepOverview.classList.add("active");
        R.spinner.classList.add("active");
        R.aiOverview.textContent = "Memuat overview AI…";
        const prompt = sa.map((a,i)=>`${surveyQs[i]} ${a}`).join("\n");
        try {
          const res = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0",
            { method:"POST",
              headers:{"Content-Type":"application/json"},
              body: JSON.stringify({ contents:[{ parts:[{ text: prompt }] }] })
            }
          );
          const j = await res.json();
          let t = j.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal.";
          R.aiOverview.innerHTML = t.replace(/\*\*/g,"").replace(/\n/g,"<br>");
        } catch {
          R.aiOverview.textContent = "Error AI.";
        } finally {
          R.spinner.classList.remove("active");
        }
      }
    };

    R.overviewNext.onclick = () => {
      R.stepOverview.classList.replace("active","hidden");
      R.stepBreakfast.classList.add("active");
      setupMeal("breakfast",
        R.searchBreakfastMain, R.listBreakfastMain,
        R.searchBreakfastSide, R.listBreakfastSide,
        R.nextBreakfast);
      setupMeal("lunch",
        R.searchLunchMain, R.listLunchMain,
        R.searchLunchSide, R.listLunchSide,
        R.nextLunch);
      setupMeal("dinner",
        R.searchDinnerMain, R.listDinnerMain,
        R.searchDinnerSide, R.listDinnerSide,
        R.nextDinner);
    };

    function setupMeal(type, searchM, listM, searchS, listS, btn) {
      selMain[type] = null;
      selSide[type] = null;

      function renderList(source, filter, container) {
        container.innerHTML = "";
        const matches = source.filter(item =>
          item.toLowerCase().includes(filter.toLowerCase())
        );
        if (!matches.length) {
          const no = document.createElement("div");
          no.className = "no-result";
          no.textContent = "Makanan Tidak Ditemukan";
          container.append(no);
          return;
        }
        matches.forEach(name => {
          const d = document.createElement("div");
          d.className = "food-item";
          d.textContent = name;
          d.onclick = () => {
            // clear selection
            Array.from(container.children).forEach(el =>
              el.classList.remove("selected")
            );
            d.classList.add("selected");
            if (container === listM) selMain[type] = name;
            else selSide[type] = name;
            btn.disabled = !(selMain[type] && selSide[type]);
          };
          container.append(d);
        });
      }

      searchM.addEventListener("input", () => {
        selMain[type] = null;
        btn.disabled = true;
        renderList(mains, searchM.value, listM);
      });
      searchS.addEventListener("input", () => {
        selSide[type] = null;
        btn.disabled = true;
        renderList(sides, searchS.value, listS);
      });

      // initial
      renderList(mains, "", listM);
      renderList(sides, "", listS);
      btn.disabled = true;
    }

    R.nextBreakfast.onclick = () => {
      R.stepBreakfast.classList.replace("active","hidden");
      R.stepLunch.classList.add("active");
    };
    R.nextLunch.onclick = () => {
      R.stepLunch.classList.replace("active","hidden");
      R.stepDinner.classList.add("active");
    };
    R.nextDinner.onclick = () => {
      R.stepDinner.classList.replace("active","hidden");
      R.selB.textContent = `${selMain.breakfast} + ${selSide.breakfast}`;
      R.selL.textContent = `${selMain.lunch} + ${selSide.lunch}`;
      R.selD.textContent = `${selMain.dinner} + ${selSide.dinner}`;
      R.stepReview.classList.add("active");
    };

    R.btnReview.onclick = async () => {
      R.spinner.classList.add("active");
      const prompt =
        `Tinjau menu saya dan hitung total kalori:\n` +
        `Sarapan: ${selMain.breakfast} + ${selSide.breakfast}\n` +
        `Makan siang: ${selMain.lunch} + ${selSide.lunch}\n` +
        `Makan malam: ${selMain.dinner} + ${selSide.dinner}\n` +
        `Bandingkan dengan kisaran harian sehat (2000–2500 kkal) dan jawab tanpa bold.`;
      try {
        const res = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0",
          {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ contents:[{ parts:[{ text: prompt }] }] })
          }
        );
        const j = await res.json();
        let t = j.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal.";
        R.aiReview.innerHTML = t.replace(/\*\*/g,"").replace(/\n/g,"<br>");
      } catch {
        R.aiReview.textContent = "Error AI.";
      } finally {
        R.spinner.classList.remove("active");
      }
    };
  });
  </script>
</body>
</html>
