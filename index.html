<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Pola Makan Sehat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ML5.js, Chart.js & Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/ml5@0.6.0/dist/ml5.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>

  <style>
    * { box-sizing: border-box; margin:0; padding:0 }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0fff8;
      color: #333;
    }
    .container {
      max-width: 480px;
      margin: 60px auto;
      padding: 24px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    .header-logo {
      text-align: center;
      margin-bottom: 16px;
    }
    .header-logo img {
      width: 80px;
      border-radius: 8px;
    }
    h1, h2 {
      text-align: center;
      color: #2a7955;
      margin-bottom: 16px;
    }
    h1 { font-size: 1.8em; }
    h2 { font-size: 1.3em; }

    section { display: none }
    section.active { display: block }

    .question-text {
      font-weight: 600;
      color: #2a7955;
      margin-bottom: 12px;
      font-size: 1.05em;
    }
    textarea {
      width: 100%;
      height: 80px;
      padding: 10px;
      border: 1px solid #cdefe1;
      border-radius: 8px;
      resize: vertical;
      font-size: 1em;
      margin-bottom: 16px;
    }
    .btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(90deg, #2a7955, #5fb58c);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
    }
    .btn:hover {
      background: linear-gradient(90deg, #236643, #4fa27f);
    }
    .project-credit {
      text-align: center;
      font-size: 0.85em;
      color: #666;
      margin-top: 24px;
    }

    /* AI overview box */
    #aiOverview {
      min-height: 80px;
      padding: 12px;
      border: 1px solid #cdefe1;
      border-radius: 8px;
      background: #f0fff8;
      font-size: 0.95em;
      line-height: 1.4;
    }

    /* Spinner overlay */
    .spinner-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      z-index: 1000;
    }
    .spinner-overlay.active {
      visibility: visible;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 6px solid #cdefe1;
      border-top-color: #2a7955;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header-logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo"
           alt="Logo Sekolah Al Ikhlas">
    </div>
    <h1>Pola Makan Sehat</h1>

    <!-- STEP 1: SURVEY -->
    <section id="step1" class="active">
      <div class="question-text" id="question"></div>
      <textarea id="answer" placeholder="Tuliskan jawaban..."></textarea>
      <button id="nextBtn" class="btn">Next</button>
      <div class="project-credit">Karya Kelompok 1 — Proyek 1</div>
    </section>

    <!-- STEP 2: AI OVERVIEW -->
    <section id="step2">
      <h2>Overview AI</h2>
      <div id="aiOverview"></div>
      <button id="overviewNext" class="btn">Lanjut</button>
    </section>
  </div>

  <div id="spinner" class="spinner-overlay">
    <div class="spinner"></div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const questions = [
      "1. Menurut kamu makanan junk food sehat atau tidak?",
      "2. Seberapa sering kamu mengonsumsi junk food?",
      "3. Berapa kali kamu makan dalam sehari?",
      "4. Apakah kamu sering mengonsumsi soda atau minuman berwarna?",
      "5. Apakah kamu sering mengonsumsi sayur-sayuran?",
      "6. Sebutkan satu makanan bergizi dan satu yang tidak bergizi.",
      "7. Menurut kamu, seberapa penting nutrisi seimbang?",
      "8. Buah atau sayur mana yang paling sering kamu konsumsi?",
      "9. Apa tantanganmu untuk makan lebih sehat?",
      "10. Langkah apa yang akan kamu ambil untuk pola makan lebih baik?"
    ];
    let idx = 0, answers = [];

    const step1       = document.getElementById("step1");
    const step2       = document.getElementById("step2");
    const questionEl  = document.getElementById("question");
    const answerEl    = document.getElementById("answer");
    const nextBtn     = document.getElementById("nextBtn");
    const aiDiv       = document.getElementById("aiOverview");
    const ovNextBtn   = document.getElementById("overviewNext");
    const spinner     = document.getElementById("spinner");

    function showQuestion(i) {
      questionEl.textContent = questions[i];
      answerEl.value = "";
      nextBtn.textContent = i < questions.length - 1 ? "Next" : "Submit";
    }
    showQuestion(idx);

    nextBtn.addEventListener("click", async () => {
      const val = answerEl.value.trim();
      if (!val) return alert("Mohon isi jawaban terlebih dahulu.");
      answers[idx] = val;

      if (idx < questions.length - 1) {
        idx++;
        showQuestion(idx);
      } else {
        // confetti + transition to overview
        confetti({ particleCount:100, spread:60, origin:{ y:0.4 } });
        step1.classList.replace("active","hidden");
        step2.classList.add("active");

        // show spinner + load AI
        spinner.classList.add("active");
        aiDiv.innerHTML = "Memuat overview AI…";
        const prompt = answers
          .map((a,i) => `${questions[i]}\nJawaban: ${a}`)
          .join("\n\n");

        try {
          const res = await fetch(
            `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [
                  { parts: [{ text: `Ringkas pola makan:\n\n${prompt}` }] }
                ]
              })
            }
          );
          const json = await res.json();
          const text =
            json.candidates?.[0]?.content?.parts?.[0]?.text ||
            "AI gagal menghasilkan overview.";
          aiDiv.innerHTML = text.replace(/\n/g, "<br>");
        } catch {
          aiDiv.innerHTML =
            "<span style='color:red'>Error memuat AI overview.</span>";
        } finally {
          spinner.classList.remove("active");
        }
      }
    });

    ovNextBtn.addEventListener("click", () => {
      // Here you can move to the next step (e.g. photo analysis)
      alert("Lanjut ke fitur berikutnya");
    });
  });
  </script>
</body>
</html>
