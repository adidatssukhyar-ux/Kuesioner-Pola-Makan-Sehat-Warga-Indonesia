<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Nutrilix</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js" defer></script>
  <style>
    :root{--p:#35a35c;--a:#5c97f5;--m:#f5bc51;--bg:#fff;--t:#333;--u:#777;--r:12px;--s:0 4px 20px rgba(0,0,0,0.05);--d:.4s}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Segoe UI,sans-serif;color:var(--t);padding:20px;background:linear-gradient(120deg,var(--p),var(--a),var(--m));background-size:600% 600%;animation:shift 16s ease infinite}
    @keyframes shift{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}
    .container{max-width:540px;margin:auto;background:var(--bg);border-radius:var(--r);box-shadow:var(--s);overflow:hidden;transition:max-width var(--d)}
    .container.wide{max-width:90%}
    .logo{background:var(--p);text-align:center;padding:16px}
    .logo img{width:60px;border-radius:8px}
    h1{text-align:center;margin:16px 0;color:var(--p)}
    .tagline{font-family:Shrikhand,cursive;text-align:center;font-size:1.4rem;color:var(--p);margin-bottom:16px}
    section,.meal{display:none;padding:24px}
    section.active,.meal.active{display:block}
    .step-title,.question-text{font-weight:600;color:var(--p);margin-bottom:12px}
    .step-title{font-size:1.1rem}
    textarea,.search-input{width:100%;padding:12px;border:1px solid #cdefe1;border-radius:var(--r);font-size:1rem;margin-bottom:12px;resize:vertical}
    .btn{width:100%;padding:14px;background:var(--p);color:#fff;border:none;border-radius:var(--r);font-size:1rem;cursor:pointer;transition:background var(--d),transform var(--d)}
    .btn:disabled{background:#ccc;cursor:not-allowed}
    .btn:not(:disabled):hover{background:var(--a);transform:translateY(-2px)}
    .credit{text-align:center;color:var(--u);font-size:.85rem;margin-top:8px}
    .food-list{display:grid;grid-template-columns:1fr 1fr;gap:8px;max-height:200px;overflow-y:auto;margin-bottom:12px}
    .food-item{padding:10px;background:#fcfcfc;border:1px solid #e0e0e0;border-radius:var(--r);text-align:center;cursor:pointer;transition:background var(--d),border-color var(--d)}
    .food-item.selected{background:var(--a);color:#fff;border-color:var(--a)}
    .no-result{grid-column:1/-1;padding:12px;text-align:center;color:var(--u)}
    .summary{background:#fcfcfc;padding:16px;border-radius:var(--r);box-shadow:var(--s);margin-bottom:16px}
    #aiOverview,#aiReview{min-height:100px;padding:16px;border:1px solid #e0e0e0;border-radius:var(--r);background:#fff;line-height:1.6;margin-bottom:16px}
    .spinner{position:fixed;inset:0;background:rgba(255,255,255,0.7);display:flex;align-items:center;justify-content:center;visibility:hidden;z-index:1000}
    .spinner.active{visibility:visible}
    .spinner-circle{width:50px;height:50px;border:6px solid #e0e0e0;border-top-color:var(--p);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="container" id="main">
    <div class="logo">
      <img src="https://yt3.ggpht.com/a/AATXAJwRp9NDxa9WX7nh8uuO9TUCUCMqCRE5yJp4CQ=s900-c-k-c0xffffffff-no-rj-mo" alt="Logo">
    </div>
    <h1>Nutrilix</h1>
    <p class="tagline">Hidup sehat itu penting!</p>

    <section id="step1" class="active">
      <div class="step-title">Survey Singkat</div>
      <div class="question-text" id="q1"></div>
      <textarea id="a1" rows="3" placeholder="Tuliskan jawaban…"></textarea>
      <button id="next1" class="btn">Next</button>
      <p class="credit">Karya Kelompok 1 Proyek 1</p>
    </section>

    <section id="step2">
      <div class="step-title">Review Jawaban</div>
      <div id="aiOverview">Memuat…</div>
      <button id="next2" class="btn">Lanjut Pilih Menu</button>
      <p class="credit">Karya Kelompok 1 Proyek 1</p>
    </section>

    <div id="meals"></div>

    <section id="step4">
      <div class="step-title">Ringkasan Menu</div>
      <div class="summary">
        <strong>Sarapan:</strong> <span id="sel-b"></span><br>
        <strong>Siang:</strong> <span id="sel-l"></span><br>
        <strong>Malam:</strong> <span id="sel-d"></span>
      </div>
      <button id="final" class="btn">Dapatkan Review Menu</button>
      <p class="credit">Karya Kelompok 1 Proyek 1</p>
      <div id="aiReview">Menunggu…</div>
    </section>
  </div>

  <div class="spinner" id="spinner">
    <div class="spinner-circle"></div>
  </div>

  <template id="tpl">
    <section class="meal">
      <div class="step-title"></div>
      <input class="search-main search-input" placeholder="Cari main…">
      <div class="list-main food-list"></div>
      <button class="other-main btn">Lainnya</button>
      <div class="custom-main" style="display:none">
        <textarea class="input-main" rows="2" placeholder="Tulis makanan lain…"></textarea>
        <button class="done-main btn">Selesai</button>
      </div>
      <input class="search-side search-input" placeholder="Cari side…">
      <div class="list-side food-list"></div>
      <button class="next-meal btn" disabled></button>
      <p class="credit">Karya Kelompok 1 Proyek 1</p>
    </section>
  </template>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const API_KEY = "AIzaSyDIVFI3M-283v1Ume5ivh3iHnByP_RAxh0";
    const ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`;
    const qs = [
      "1. Menurut kamu junk food sehat atau tidak?",
      "2. Seberapa sering kamu makan junk food?",
      "3. Berapa kali makan sehari?",
      "4. Sering minum soda/minuman berwarna?",
      "5. Sering makan sayur?",
      "6. Sebutkan makanan bergizi & tidak bergizi",
      "7. Pentingkah makanan bergizi?",
      "8. Sayur & buah termasuk bergizi?",
      "9. Apakah hari ini sudah sarapan?",
      "10. Mengapa suka gorengan?"
    ];
    const mains = ["Nasi Goreng","Soto Ayam","Rendang","Bakso","Mie Goreng","Pecel Lele","Ayam Goreng","Pempek","Gado Gado","Ketoprak","Lontong Sayur","Soto Betawi","Martabak Telor","Martabak Manis","Bubur Ayam","Nasi Padang","Nasi Uduk","Scrambled Eggs","Pancakes","Grilled Chicken","Caesar Salad","Spaghetti Bolognese","Beef Steak","Chicken Sandwich","Shawarma","Falafel","Biryani","Roti Canai","Chicken Tikka","Lamb Kofta","Tabbouleh","Samosa"];
    const sides = ["Nasi Putih","Kentang Goreng","Mashed Potatoes","Sayur Bening","Sambal","Kerupuk","Tempe Goreng","Tahu Goreng","Salad Buah","Urap Sayur","Kentang Rebus","Kentang Panggang","Oatmeal","Roti Tawar","Polenta","Quinoa","Kuskus","Jagung Rebus","Tumis Brokoli","Hasselback Potato"];

    const $ = id => document.getElementById(id);
    const show = id => {
      document.querySelectorAll("section,.meal").forEach(el => el.classList.remove("active"));
      $(id).classList.add("active");
    };
    const aiFetch = async (prompt, out) => {
      $("spinner").classList.add("active");
      try {
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ contents:[{ parts:[{ text: prompt }] }] })
        });
        const json = await res.json();
        const text = json.candidates?.[0]?.content?.parts?.[0]?.text || "Gagal memuat AI.";
        out.innerHTML = text.replace(/\n/g, "<br>");
      } catch (e) {
        out.innerHTML = "Error: " + e.message;
      } finally {
        $("spinner").classList.remove("active");
      }
    };

    // Survey
    let idx = 0, answers = [];
    $("q1").textContent = qs[0];
    $("next1").onclick = () => {
      const v = $("a1").value.trim();
      if (!v) return alert("Isi jawaban…");
      answers[idx] = v;
      if (idx < qs.length - 1) {
        idx++;
        $("q1").textContent = qs[idx];
        $("a1").value = "";
        $("next1").textContent = idx < qs.length - 1 ? "Next" : "Submit";
      } else {
        show("step2");
        aiFetch(
          "Tinjau survey:\n" + qs.map((q,i) => q + " " + answers[i]).join("\n"),
          $("aiOverview")
        );
      }
    };

    // Meal steps
    $("next2").onclick = () => {
      $("main").classList.add("wide");
      const keys = ["b","l","d"], labels = ["Sarapan","Siang","Malam"], nextTxt = ["Next: Siang","Next: Malam","Lanjut: Ringkasan"];
      const sel = {};
      keys.forEach((k,i) => {
        const frag = document.getElementById("tpl").content.cloneNode(true);
        const sec = frag.querySelector("section"); sec.id = "step" + k;
        sec.querySelector(".step-title").textContent = labels[i];
        const sm = sec.querySelector(".search-main"), lm = sec.querySelector(".list-main");
        const om = sec.querySelector(".other-main"), cm = sec.querySelector(".custom-main");
        const im = sec.querySelector(".input-main"), dm = sec.querySelector(".done-main");
        const ss = sec.querySelector(".search-side"), ls = sec.querySelector(".list-side");
        const nb = sec.querySelector(".next-meal"); nb.textContent = nextTxt[i];
        let m="", s="";

        const render = (arr, f, container, isMain) => {
          container.innerHTML = "";
          const list = arr.filter(x => x.toLowerCase().includes(f.toLowerCase()));
          if (!list.length) return container.innerHTML = '<div class="no-result">Tidak ditemukan</div>';
          list.forEach(n => {
            const d = document.createElement("div");
            d.className = "food-item"; d.textContent = n;
            d.onclick = () => {
              container.querySelectorAll(".food-item").forEach(e => e.classList.remove("selected"));
              d.classList.add("selected");
              isMain ? m = n : s = n;
              nb.disabled = !(m && s);
            };
            container.appendChild(d);
          });
        };

        sm.oninput = () => { m=""; nb.disabled=true; cm.style.display="none"; render(mains, sm.value, lm, true); };
        ss.oninput = () => { s=""; nb.disabled=true; render(sides, ss.value, ls, false); };
        om.onclick = () => { sm.style.display="none"; lm.style.display="none"; om.style.display="none"; cm.style.display="block"; };
        dm.onclick = () => {
          const v = im.value.trim();
          if (!v) return alert("Tulis makanan…");
          m = v; cm.style.display="none"; sm.style.display="block"; om.style.display="block"; lm.style.display="grid"; nb.disabled = !(m && s);
        };

        render(mains, "", lm, true); render(sides, "", ls, false);
        nb.onclick = () => {
          sel[k] = m + " + " + s;
          if (i < keys.length - 1) show("step" + keys[i+1]);
          else {
            $("sel-b").textContent = sel.b;
            $("sel-l").textContent = sel.l;
            $("sel-d").textContent = sel.d;
            show("step4");
          }
        };

        document.getElementById("meals").appendChild(sec);
      });
      show("stepb");
    };

    // Final review
    $("final").onclick = () => {
      aiFetch(
        "Tinjau menu:\nSarapan: "+$("sel-b").textContent+
        "\nSiang: "+$("sel-l").textContent+
        "\nMalam: "+$("sel-d").textContent,
        $("aiReview")
      );
      confetti();
    };
  });
  </script>
</body>
</html>
